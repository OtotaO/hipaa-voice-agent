# ============================================
# HIPAA Voice Agent - Environment Configuration
# ============================================
# CRITICAL: This file contains sensitive credentials
# - Never commit to version control
# - Encrypt at rest
# - Rotate credentials regularly
# - Limit access to authorized personnel only
# ============================================

# --------------------------------------------
# DEPLOYMENT ENVIRONMENT
# --------------------------------------------
ENVIRONMENT=production
DEBUG=false
LOG_LEVEL=INFO
SERVICE_NAME=hipaa-voice-agent

# --------------------------------------------
# TWILIO CONFIGURATION (HIPAA Project)
# --------------------------------------------
# IMPORTANT: Must use HIPAA-designated project
TWILIO_ACCOUNT_SID=ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
TWILIO_AUTH_TOKEN=your_auth_token_here
TWILIO_API_KEY_SID=SKxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
TWILIO_API_KEY_SECRET=your_api_secret_here

# HIPAA Project Configuration
TWILIO_HIPAA_PROJECT_ID=PJxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
TWILIO_PHONE_NUMBER=+1XXXXXXXXXX
TWILIO_STATUS_CALLBACK_URL=https://your-domain.com/webhooks/twilio/status
TWILIO_VOICE_METHOD=POST
TWILIO_VOICE_URL=https://your-domain.com/webhooks/twilio/voice

# Twilio Media Streams (for Pipecat)
TWILIO_MEDIA_STREAMS_ENABLED=true
TWILIO_MEDIA_STREAM_URL=wss://your-domain.com:8080/media
TWILIO_MEDIA_STREAM_TRACK=inbound

# Twilio Security
TWILIO_SIGNATURE_VALIDATION=true
TWILIO_SSL_VERIFY=true
TWILIO_EDGE=sydney  # Choose nearest edge location

# --------------------------------------------
# AWS CONFIGURATION (Transcribe Medical)
# --------------------------------------------
AWS_ACCESS_KEY_ID=AKIAXXXXXXXXXXXXXXXX
AWS_SECRET_ACCESS_KEY=your_aws_secret_key_here
AWS_REGION=us-east-1
AWS_S3_BUCKET=hipaa-voice-recordings-encrypted
AWS_S3_ENCRYPTION=AES256
AWS_S3_VERSIONING=true

# AWS Transcribe Medical Settings
AWS_TRANSCRIBE_MEDICAL_ENABLED=true
AWS_TRANSCRIBE_MEDICAL_SPECIALTY=PRIMARYCARE
AWS_TRANSCRIBE_MEDICAL_TYPE=CONVERSATION
AWS_TRANSCRIBE_MEDICAL_LANGUAGE=en-US
AWS_TRANSCRIBE_MEDICAL_ENABLE_CHANNEL_IDENTIFICATION=true
AWS_TRANSCRIBE_MEDICAL_SHOW_SPEAKER_LABELS=true
AWS_TRANSCRIBE_MEDICAL_MAX_ALTERNATIVES=3
AWS_TRANSCRIBE_MEDICAL_FILTER_PROFANITY=false

# AWS Security
AWS_KMS_KEY_ID=arn:aws:kms:us-east-1:XXXXXXXXXXXX:key/XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX
AWS_VPC_ENDPOINT=true
AWS_PRIVATE_LINK=true

# --------------------------------------------
# SELF-HOSTED LLM CONFIGURATION
# --------------------------------------------
LLM_PROVIDER=vllm
LLM_ENDPOINT=http://vllm:8000/v1
LLM_MODEL=meta-llama/Llama-3-70b-chat-hf
LLM_API_KEY=local-no-auth-required  # Set if using authentication
LLM_MAX_TOKENS=2048
LLM_TEMPERATURE=0.7
LLM_TOP_P=0.9
LLM_FREQUENCY_PENALTY=0.0
LLM_PRESENCE_PENALTY=0.0
LLM_TIMEOUT=30
LLM_MAX_RETRIES=3

# LLM Safety & Compliance
LLM_ENABLE_CONTENT_FILTER=true
LLM_PHI_DETECTION=true
LLM_MEDICAL_SAFETY_CHECK=true
LLM_REFUSE_MEDICAL_ADVICE=true

# --------------------------------------------
# PIPECAT CONFIGURATION
# --------------------------------------------
PIPECAT_HOST=0.0.0.0
PIPECAT_PORT=8080
PIPECAT_WEBSOCKET_PATH=/media
PIPECAT_TRANSPORT=websocket
PIPECAT_SERIALIZER=twilio
PIPECAT_ENABLE_METRICS=true
PIPECAT_METRICS_PORT=8081
PIPECAT_MAX_CONNECTIONS=100
PIPECAT_CONNECTION_TIMEOUT=300

# Pipecat Audio Settings
PIPECAT_AUDIO_SAMPLE_RATE=8000
PIPECAT_AUDIO_CHANNELS=1
PIPECAT_AUDIO_ENCODING=mulaw
PIPECAT_VAD_ENABLED=true
PIPECAT_VAD_THRESHOLD=0.5
PIPECAT_SILENCE_THRESHOLD=2000

# Pipecat Security
PIPECAT_TLS_ENABLED=true
PIPECAT_TLS_CERT=/certs/server.crt
PIPECAT_TLS_KEY=/certs/server.key
PIPECAT_TLS_CA=/certs/ca.crt
PIPECAT_ENABLE_CORS=false

# --------------------------------------------
# TTS CONFIGURATION (Optional - can use Twilio TTS)
# --------------------------------------------
TTS_PROVIDER=twilio  # Options: twilio, riva, azure
TTS_VOICE=Polly.Joanna
TTS_LANGUAGE=en-US
TTS_SPEED=1.0
TTS_PITCH=0
TTS_ENABLE_SSML=true

# NVIDIA Riva TTS (if self-hosting)
# RIVA_TTS_ENDPOINT=localhost:50051
# RIVA_TTS_VOICE=English-US.Female-1
# RIVA_TTS_SAMPLE_RATE=22050
# RIVA_TTS_USE_SSL=true

# --------------------------------------------
# TEMPORAL WORKFLOW ENGINE
# --------------------------------------------
TEMPORAL_HOST=temporal
TEMPORAL_PORT=7233
TEMPORAL_NAMESPACE=medical
TEMPORAL_TASK_QUEUE=voice-agent-tasks
TEMPORAL_WORKFLOW_TIMEOUT=3600
TEMPORAL_ENABLE_ENCRYPTION=true
TEMPORAL_DATA_CONVERTER_ENCRYPTION_KEY=base64_encoded_32_byte_key_here

# Temporal Database
TEMPORAL_DB_HOST=postgres
TEMPORAL_DB_PORT=5432
TEMPORAL_DB_NAME=temporal
TEMPORAL_DB_USER=temporal
TEMPORAL_DB_PASSWORD=strong_temporal_password_here

# Temporal Security
TEMPORAL_TLS_ENABLED=true
TEMPORAL_TLS_FRONTEND_CERT=/certs/temporal-frontend.crt
TEMPORAL_TLS_FRONTEND_KEY=/certs/temporal-frontend.key
TEMPORAL_MTLS_ENABLED=false

# --------------------------------------------
# FHIR INTEGRATION
# --------------------------------------------
FHIR_VERSION=R4
FHIR_BASE_URL=https://your-ehr-system.com/fhir/r4
FHIR_TENANT_ID=your_tenant_id
FHIR_CLIENT_ID=your_fhir_client_id
FHIR_CLIENT_SECRET=your_fhir_client_secret
FHIR_SCOPE=launch patient/*.read patient/*.write
FHIR_AUTH_TYPE=oauth2  # Options: oauth2, basic, smart
FHIR_TOKEN_ENDPOINT=https://your-ehr-system.com/oauth2/token
FHIR_TIMEOUT=30
FHIR_MAX_RETRIES=3
FHIR_VERIFY_SSL=true

# FHIR Caching (be careful with PHI)
FHIR_CACHE_ENABLED=false
FHIR_CACHE_TTL=0

# --------------------------------------------
# DATABASE CONFIGURATION (Application)
# --------------------------------------------
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB=medical
POSTGRES_USER=medical_app
POSTGRES_PASSWORD=strong_postgres_password_here
POSTGRES_SSL_MODE=require
POSTGRES_MAX_CONNECTIONS=100
POSTGRES_POOL_SIZE=20

# Database Encryption
DB_ENCRYPTION_KEY=base64_encoded_32_byte_key_here
DB_ENCRYPT_PII=true
DB_ENCRYPT_PHI=true

# --------------------------------------------
# REDIS CONFIGURATION
# --------------------------------------------
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=strong_redis_password_here
REDIS_DB=0
REDIS_SSL=true
REDIS_MAX_CONNECTIONS=50
REDIS_CONNECTION_TIMEOUT=5

# Redis Security
REDIS_DISABLE_COMMANDS=FLUSHDB,FLUSHALL,KEYS,CONFIG
REDIS_ENABLE_ACL=true

# --------------------------------------------
# SECURITY & COMPLIANCE
# --------------------------------------------
# Encryption Keys (rotate regularly)
MASTER_ENCRYPTION_KEY=base64_encoded_32_byte_master_key_here
DATA_ENCRYPTION_KEY=base64_encoded_32_byte_data_key_here
SESSION_SECRET=random_64_character_string_here

# JWT Configuration
JWT_SECRET=your_jwt_secret_here
JWT_ALGORITHM=RS256
JWT_EXPIRY=3600
JWT_REFRESH_EXPIRY=86400

# API Security
API_KEY_HEADER=X-API-Key
API_RATE_LIMIT=100
API_RATE_LIMIT_WINDOW=60
ENABLE_API_KEY_VALIDATION=true

# CORS Settings
CORS_ENABLED=false
CORS_ORIGINS=https://your-domain.com
CORS_METHODS=GET,POST
CORS_HEADERS=Content-Type,Authorization

# --------------------------------------------
# AUDIT & LOGGING
# --------------------------------------------
AUDIT_ENABLED=true
AUDIT_LOG_PATH=/logs/audit
AUDIT_LOG_RETENTION_DAYS=2555  # 7 years for HIPAA
AUDIT_LOG_ENCRYPTION=true
AUDIT_INCLUDE_REQUEST_BODY=false  # Don't log PHI
AUDIT_INCLUDE_RESPONSE_BODY=false  # Don't log PHI

# PHI Handling
PHI_REDACTION_ENABLED=true
PHI_DETECTION_PATTERNS=ssn,mrn,dob,address,phone
PHI_MASK_CHARACTER=*
PHI_AUDIT_ACCESS=true

# Log Settings
LOG_FORMAT=json
LOG_OUTPUT=file
LOG_PATH=/logs/application
LOG_ROTATION=daily
LOG_RETENTION_DAYS=90
LOG_ENCRYPT=true
SENTRY_DSN=  # Leave empty if not using Sentry

# --------------------------------------------
# MONITORING & ALERTING
# --------------------------------------------
PROMETHEUS_ENABLED=true
PROMETHEUS_PORT=9090
GRAFANA_ENABLED=true
GRAFANA_PORT=3000
GRAFANA_PASSWORD=strong_grafana_password_here

# Alerting
ALERT_ENABLED=true
ALERT_PROVIDER=pagerduty  # Options: pagerduty, opsgenie, slack
PAGERDUTY_API_KEY=your_pagerduty_key_here
PAGERDUTY_SERVICE_KEY=your_service_key_here
ALERT_PHI_BREACH=critical
ALERT_SYSTEM_DOWN=critical
ALERT_HIGH_ERROR_RATE=warning

# --------------------------------------------
# FEATURE FLAGS
# --------------------------------------------
ENABLE_AFTER_HOURS_RECEPTIONIST=true
ENABLE_RESULTS_LINE=true
ENABLE_REFILL_CONCIERGE=true
ENABLE_PRIOR_AUTH=true
ENABLE_APPOINTMENT_BOOKING=true
ENABLE_SMS_CONFIRMATIONS=true  # No PHI in SMS
ENABLE_EMAIL_CONFIRMATIONS=true  # No PHI in email
ENABLE_VOICE_MAIL=false  # Disabled by default for PHI safety

# --------------------------------------------
# CALL HANDLING
# --------------------------------------------
MAX_CALL_DURATION=1800  # 30 minutes
CALL_TIMEOUT_WARNING=1500  # Warning at 25 minutes
EMERGENCY_TRANSFER_NUMBER=+1XXXXXXXXXX
BUSINESS_HOURS_START=08:00
BUSINESS_HOURS_END=17:00
BUSINESS_TIMEZONE=America/New_York

# Call Recording (if required by policy)
CALL_RECORDING_ENABLED=false
CALL_RECORDING_ANNOUNCEMENT=true
CALL_RECORDING_ENCRYPTION=true
CALL_RECORDING_RETENTION_DAYS=7
CALL_RECORDING_AUTO_DELETE=true

# --------------------------------------------
# KENTUCKY SPECIFIC SETTINGS
# --------------------------------------------
STATE_JURISDICTION=KY
CONSENT_TYPE=one_party
KASPER_INTEGRATION_ENABLED=false  # Enable if needed
KASPER_API_ENDPOINT=
KASPER_API_KEY=

# --------------------------------------------
# BACKUP & DISASTER RECOVERY
# --------------------------------------------
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *  # 2 AM daily
BACKUP_RETENTION_DAYS=30
BACKUP_ENCRYPTION=true
BACKUP_S3_BUCKET=hipaa-backups-encrypted
BACKUP_NOTIFICATION_EMAIL=ops@your-domain.com

# --------------------------------------------
# DEVELOPMENT/TESTING (disable in production)
# --------------------------------------------
DEV_MODE=false
MOCK_SERVICES=false
SKIP_AUTH=false
VERBOSE_ERRORS=false
ENABLE_SWAGGER=false
ENABLE_GRAPHQL_PLAYGROUND=false

# ============================================
# END OF CONFIGURATION
# ============================================
# Remember to:
# 1. Replace all placeholder values
# 2. Encrypt this file at rest
# 3. Restrict file permissions (600)
# 4. Never commit to version control
# 5. Rotate credentials regularly
# 6. Set up secret management (Vault, AWS Secrets Manager)
# ============================================
